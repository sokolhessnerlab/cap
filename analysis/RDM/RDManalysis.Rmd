---
title: 'CAP: RDM analysis'
author: "Hayley Brooks"
date: "5/13/2021"
output: html_document
---

```{r setup, include=FALSE}

library('config')
config = config::get()

rdm_csv = file.path(config$path$combined, config$RDMcsvs$RDM_qualtrics);
exclsnPhs1_csv = file.path(config$path$combined, config$EXCLUSIONcsvs$RDM_AX_Qual_Phs1exclusion);
exclsnPhs2_csv = file.path(config$path$combined, config$EXCLUSIONcsvs$RDM_AX_Qual_Phs2exclusion);

rdmQualtrics = read.csv(rdm_csv); # loads RDM + Qualtrics data both phases (takes several seconds)
excludePhs1 = read.csv(exclsnPhs1_csv); # loads exclusion for phase 1
excludePhs2 = read.csv(exclsnPhs2_csv); # loads exclusion for phase 2

# Remove the extra "X" column present as the first column in datasets
rdmQualtrics = rdmQualtrics[,(2:ncol(rdmQualtrics))];
excludePhs1 = excludePhs1[,(2:ncol(excludePhs1))];
excludePhs2 = excludePhs2[,(2:ncol(excludePhs2))];

```


```{r}

library("lme4");
library("ggplot2");
library("ggExtra");

```

#### Applying exlcusion to RDM dataset
```{r}

# Phase 1: 
# RDM: 26 participants excluded
subIDrdmPhs1Exclude = excludePhs1$subID[!is.na(excludePhs1$rdmPhs1exclude) & excludePhs1$rdmPhs1exclude==1]

# Qualtrics: 3 participants excluded
subIDqualPhs1Exclude = excludePhs1$subID[!is.na(excludePhs1$qualPhs1exclude) & excludePhs1$qualPhs1exclude==1]

# Phase 2: 
# RDM: 31 participants excluded
subIDrdmPhs2Exclude = excludePhs2$subID[!is.na(excludePhs2$rdmPhs2exclude) & excludePhs2$rdmPhs2exclude==1]
 
# Qualtrics: 0 participants excluded
subIDqualPhs2Exclude = excludePhs2$subID[!is.na(excludePhs2$qualPhs2exclude) & excludePhs2$qualPhs2exclude==1]


# Put NAs in place of excluded data:
# For now, ust exclude based on RDM or Qualtrics, don't apply an RDM or Qualtrics exclusion across both. 
# This way, we can include as many people as possible within the separate RDM and Qualtrics analyses and when we want to look at RDM + Qualtrics, the NAs will be there for those we need to exclude.

# 
# column order is funky. RDM stuff is in columns 1-5, 7-14, 17-18, and day, phase, and subID are dispersed throughout.
rdmColumns = c(1:5,7:14,17:18);
#rdmColNames = c("rdmRiskyGain", "rdmRiskyLoss","rdmAlternative", "rdmIsi", "rdmIti","rdmItiExtra","rdmRT" ,"rdmOutcome","rdmChoice","rdmGroundEV","rdmEvInd","rdmRunSize" ,"rdmOutcomeType", "rdmTask","rdmTrial");


# Qualtrics stuff starts at column 19, or "stai_s_score" until column 70 or "ses_needbasedCollegeAid_recode"
qualColumns = c(19:70);

#qualColNames = c("stai_s_score", "stai_t_score","pss_score", "pss_stressedToday","uclal_score", "covq_PAB_q1_personalRisk", "covq_PAB_q2_threat", "covq_PAB_q3_personallyDie","covq_PAB_q4_otherPersonDie", "covq_attentionCheck_select_6","covq_attentionCheck_passed", "covq_PAB_q5_currentCases", "covq_PAB_q5_currentCases_recode", "covq_PAB_q6_tested","covq_PAB_q6_tested_recode", "covq_PAB_q7_personalCovidSuspect", "covq_PAB_q7_personalCovidSuspect_recode", "covq_PAB_q8_knowPositivePerson","covq_PAB_q8_knowPositivePerson_recode", "covq_PAB_q9_socialDistanceLevel", "covq_PAB_q9_socialDistanceLevel_recode", "demo_gender","demo_gender_recode", "demo_race","demo_race_recode", "demo_ethnicity","demo_ethnicity_recode", "loc_state","loc_county", "loc_fips", "ses_childhood_freeReducedLunch", "ses_childhood_freeReducedLunch_recode","ses_childhood_communityComp", "ses_childhood_communityComp_recode","ses_childhood_nationalComp", "ses_childhood_nationalComp_recode", "ses_motherEdLevel", "ses_motherEdLevel_recode","ses_fatherEdLevel" , "ses_fatherEdLevel_recode", "ses_childhoood_homeOwnership", "ses_childhoood_homeOwnership_recode","ses_current_billHelp", "ses_current_billHelp_recode","ses_current_mainResponsibilities", "ses_current_mainResponsibilities_recode", "ses_personalEdLevel", "ses_personalEdLevel_recode" ,"ses_financialWorryFreq","ses_financialWorryFreq_recode", "ses_needbasedCollegeAid", "ses_needbasedCollegeAid_recode")
  

# Put NAs in RDM columns for excluded phase 1 and phase 2 participants
rdmQualtrics[rdmQualtrics$subID %in% subIDrdmPhs1Exclude & rdmQualtrics$phase==1,rdmColumns] = NA; # phase 1
rdmQualtrics[rdmQualtrics$subID %in% subIDrdmPhs2Exclude & rdmQualtrics$phase==2,rdmColumns] = NA; # phase 2


# Put NAs in Qualtrics columns for excluded phase 1 and phase 2 participants
rdmQualtrics[rdmQualtrics$subID %in% subIDqualPhs1Exclude & rdmQualtrics$phase==1,qualColumns] = NA; # phase 1
rdmQualtrics[rdmQualtrics$subID %in% subIDqualPhs2Exclude & rdmQualtrics$phase==2,qualColumns] = NA; # phase 2

# Note: if participants were excluded in phase 1, they are not automatically excluded in phase 2!
  
```



#### Creating variables for analysis - if this gets really large, consider making separate script
```{r}

```

#### Participant stuff
```{r}
nSubPhs1 = 
```


### Risky decision-making analysis
#### Basics, e.g. p(gamble)
```{r}
# All participants who completed phase 1 (n=540) and all participants who completed phase 2 (n=355)


```

