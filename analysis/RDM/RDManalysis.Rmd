---
title: 'CAP: RDM analysis'
author: "Hayley Brooks"
date: "5/13/2021"
output: html_document
---

Data set up is taken care of by RDMsteup.Rmd script. HRB working on the configuration part so it will run automatically in this script but until then it has to be run by hand.
```{r setup, include=FALSE}

library('config')
config = config::get()


setup_source = file.path(config$code_files$setup_data)
source(setup_source) #, local = knitr::knit_global())

```


### Risky decision-making analysis
#### Probability of gambling
```{r}
# GROUP LEVEL
Phs1Pgam = mean(rdmQualtrics$rdmChoice[rdmQualtrics$phase==1], na.rm=T); # phase 1 pgamble = 0.3901198
Phse2Pgam = mean(rdmQualtrics$rdmChoice[rdmQualtrics$phase==2], na.rm=T); # phase 2 pgamble = 0.3783025
bothPhsPgam = mean(rdmQualtrics$rdmChoice[rdmQualtrics$subID %in% BothPhsSubIDs], na.rm=T); # pgamble across participants who completed both phase 1 and phase (n=313) = 0.3867135

# 95% CI
# phase 1 (n=518)
me1 = qnorm(.975)*(Phs1Pgam/sqrt(Phs1nSub)); #0.03359551
Phs1Pgam + me1; #0.4237153
Phs1Pgam - me1; #0.3565243

# phase 2 (n=326)
me2 = qnorm(.975)*(Phse2Pgam/sqrt(Phs2nSub)); #0.04106563
Phse2Pgam + me2; #0.4193681
Phse2Pgam - me2; #0.3372368

# phase 1 and phase 2 (n = 313)
me3 = qnorm(.975)*(bothPhsPgam/sqrt(BothPhsnSub)); #0.04284156
bothPhsPgam + me3; #0.4295551
bothPhsPgam - me3; #0.343872



# INDIVIDUAL LEVEL

# data frame where each row is a participant and there are 6 columns: {subID, day, phase 1, phase 2, both  phases, diffPgam}. If a participant is not included because they did not complete phase 2 or they were excluded, there will be an NaN in the corresponding  column. "diffPgam" is the difference in probability of gambling between two phases if we have that information for a given participant

pGambleSubID = as.data.frame(matrix(data=NA, nrow =nSubB4exclusion, ncol=6, dimnames=list(c(NULL), c("subID", "day", "phs1pgam","phs2pgam","bothPhspgam", "diffPgam"))))

for (s in 1:nSubB4exclusion) {
  
  
  subPhs1 = rdmQualtrics[rdmQualtrics$subID==subNumB4exclusion[s] & rdmQualtrics$phase==1,rdmColumns];
  subPhs2 = rdmQualtrics[rdmQualtrics$subID==subNumB4exclusion[s] & rdmQualtrics$phase==2,rdmColumns];
  subDay = rdmQualtrics$day[rdmQualtrics$subID==subNumB4exclusion[s]]
  
  pGambleSubID$subID[s] = subNumB4exclusion[s]
  pGambleSubID$day[s] = subDay[1]
  pGambleSubID$phs1pgam[s] = mean(subPhs1$rdmChoice, na.rm=T)
  pGambleSubID$phs2pgam[s] = mean(subPhs2$rdmChoice, na.rm=T)
  pGambleSubID$bothPhspgam[s] = mean(c(subPhs1$rdmChoice, subPhs2$rdmChoice), na.rm=T)
  pGambleSubID$diffPgam[s] = pGambleSubID$phs2pgam[s] - pGambleSubID$phs1pgam[s]
 
};

```

